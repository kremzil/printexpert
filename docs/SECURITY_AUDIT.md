# –û–¢–ß–ï–¢ –ü–û –ê–£–î–ò–¢–£ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ò –ü–†–û–í–ï–†–ö–ï –ù–ê –û–®–ò–ë–ö–ò
## –ü—Ä–æ–µ–∫—Ç: PRINTEXPERT-NEXT/web

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 25 —è–Ω–≤–∞—Ä—è 2026  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 9 —Ñ–µ–≤—Ä–∞–ª—è 2026 (–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 0.1.0  
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** Next.js 16.1.2, React 19.2.3, PostgreSQL 16, Prisma 7.3.0, NextAuth v5 (beta)

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò

### 1. ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–∞—Ö** ‚Üí –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –†–ï–®–ï–ù–û (25.01.2026)

**–†–µ—à–µ–Ω–∏–µ:**
- –í–Ω–µ–¥—Ä—ë–Ω **NextAuth v5** —Å —Ä–æ–ª–µ–≤–æ–π –º–æ–¥–µ–ª—å—é (`UserRole`: USER, ADMIN)
- Middleware –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ `authorized` callback –≤ `auth.config.ts`:
  - `/admin/*` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth` –±–µ–∑ ADMIN —Ä–æ–ª–∏
  - `/account/*` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth` –±–µ–∑ —Å–µ—Å—Å–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω—ã helpers –≤ `lib/auth-helpers.ts`:
  - `requireAuth()` ‚Äî —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `requireAdmin()` ‚Äî —Ç—Ä–µ–±—É–µ—Ç —Ä–æ–ª—å ADMIN

**–ó–∞—â–∏—â—ë–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
- `app/admin/page.tsx` ‚Äî –≤—ã–∑–æ–≤ `requireAdmin()`
- `app/admin/products/[id]/page.tsx` ‚Äî –≤—ã–∑–æ–≤ `requireAdmin()`
- `app/admin/kategorie/page.tsx` ‚Äî –≤—ã–∑–æ–≤ `requireAdmin()`
- `app/admin/vlastnosti/page.tsx` ‚Äî –≤—ã–∑–æ–≤ `requireAdmin()`

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ —Å–µ—Å—Å–∏–∏ ‚Üí 302 redirect –Ω–∞ `/auth`
- –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —Å —Ä–æ–ª—å—é USER ‚Üí 403 Forbidden

---

### 2. ‚úÖ **–ù–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–π API –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤** ‚Üí –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –†–ï–®–ï–ù–û (25.01.2026)

**–†–µ—à–µ–Ω–∏–µ:**
- `app/api/uploads/route.ts` —Ç—Ä–µ–±—É–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `auth()` –∏–∑ NextAuth

**–ö–æ–¥:**
```typescript
export async function POST(request: Request) {
  const session = await auth()
  if (!session?.user) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 })
  }
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Üí 401 Unauthorized
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å —Å–µ—Å—Å–∏–µ–π ‚Üí 200 OK

---

### 3. ‚úÖ **Server Actions –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** ‚Üí –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –†–ï–®–ï–ù–û (25.01.2026)

**–†–µ—à–µ–Ω–∏–µ:**
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ server actions –∑–∞—â–∏—â–µ–Ω—ã —á–µ—Ä–µ–∑ `requireAdmin()`

**–ó–∞—â–∏—â—ë–Ω–Ω—ã–µ actions:**
- `app/admin/products/[id]/actions.ts`:
  - `updateProductDetails`
  - `deleteMatrix`
  - `createMatrix`
- `app/admin/kategorie/actions.ts`:
  - `createCategory`
  - `updateCategory`
  - `deleteCategory`
- `app/admin/vlastnosti/actions.ts`:
  - `createAttribute`
  - `deleteAttribute`
  - `createAttributeValue`
  - `deleteAttributeValue`

**–ö–æ–¥ (–ø—Ä–∏–º–µ—Ä):**
```typescript
"use server"
import { requireAdmin } from "@/lib/auth-helpers"

export async function updateProductDetails(formData: FormData) {
  await requireAdmin() // 403 –µ—Å–ª–∏ –Ω–µ ADMIN
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—ã–∑–æ–≤ action –±–µ–∑ —Å–µ—Å—Å–∏–∏ ‚Üí redirect –Ω–∞ `/auth`
- –í—ã–∑–æ–≤ action —Å USER —Ä–æ–ª—å—é ‚Üí 403 Forbidden

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò (–æ—Å—Ç–∞–ª–∏—Å—å)

–ù–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ.

## üü† –†–ê–ù–ï–ï –í–´–°–û–ö–ò–ô –†–ò–°–ö (—Å–Ω–∏–∂–µ–Ω/–∏—Å–ø—Ä–∞–≤–ª–µ–Ω)

### 4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ dangerouslySetInnerHTML –¥–ª—è HTML –∏–∑ –ë–î**
**–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –°–†–ï–î–ù–ò–ô (—Å–Ω–∏–∂–µ–Ω 03.02.2026)

**–ü—Ä–æ–±–ª–µ–º–∞ (–∫–æ–Ω—Ç–µ–∫—Å—Ç):**
- HTML —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —á–µ—Ä–µ–∑ `dangerouslySetInnerHTML`
- XSS –≤–æ–∑–º–æ–∂–µ–Ω, –µ—Å–ª–∏ –≤ –ë–î –æ–∫–∞–∂–µ—Ç—Å—è –Ω–µ—Åanit–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- `app/product/[slug]/product-page-client.tsx`

**–¢–µ–∫—É—â–∞—è –∑–∞—â–∏—Ç–∞ (–¥–≤–æ–π–Ω–∞—è):**
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–æ–º: `app/product/[slug]/page.tsx` –ø—Ä–æ–≥–æ–Ω—è–µ—Ç `product.description/excerpt` —á–µ—Ä–µ–∑ `sanitizeHtml()`.
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏:
  - `app/admin/products/[id]/actions.ts` —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä—É–µ—Ç `excerpt/description` –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.
  - `app/api/admin/products/import/route.ts` —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä—É–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è.
- –£—Å–∏–ª–µ–Ω–Ω—ã–π sanitizer: `lib/sanitize-html.ts` (–±–ª–æ–∫ SVG, —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ URL, iframe —Ç–æ–ª—å–∫–æ YouTube/Vimeo –∏ —Ç.–¥.).
- RichTextEditor –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç video embeds —Ç–æ–ª—å–∫–æ –∫ YouTube/Vimeo.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ù–µ —Ä–∞—Å—à–∏—Ä—è—Ç—å allowlist –≤ `lib/sanitize-html.ts` –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç-–∫–µ–π—Å—ã –Ω–∞ ‚Äú–ø–ª–æ—Ö–æ–π‚Äù HTML (script, javascript:, data:, svg, onerror, –∏ —Ç.–ø.).
- –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ —É—Å–∏–ª–∏—Ç—å –µ—â—ë –±–æ–ª—å—à–µ ‚Äî –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ battle-tested sanitizer (–ø–æ—Ç—Ä–µ–±—É–µ—Ç –Ω–æ–≤–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏).

---

### 5. **Rate limiting (anti-spam)**
**–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –ù–ò–ó–ö–ò–ô (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 03.02.2026)

**–ß—Ç–æ –±—ã–ª–æ:**
- In-memory `Map` –¥–ª—è rate limit (–ø–ª–æ—Ö–æ –¥–ª—è standalone/multi-process –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ).

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- Rate limiting –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –≤ PostgreSQL —á–µ—Ä–µ–∑ Prisma:
  - –ú–æ–¥–µ–ª—å: `RateLimitEntry` –≤ `prisma/schema.prisma` (PK `key`, –∏–Ω–¥–µ–∫—Å –ø–æ `resetAt`).
  - –õ–æ–≥–∏–∫–∞: `lib/rate-limit.ts` (–≤ —Ç.—á. –ª–µ–Ω–∏–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤, –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ —á–∞—Å/–ø—Ä–æ—Ü–µ—Å—Å).
- –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–µ ‚Äú–¥–æ—Ä–æ–≥–∏–µ/—à—É–º–Ω—ã–µ‚Äù –¥–µ–π—Å—Ç–≤–∏—è:
  - `app/api/contact/route.ts`
  - `app/api/price/route.ts`
  - `app/api/checkout/route.ts` (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
  - `app/api/auth/[...nextauth]/route.ts` (signin magic link / callback credentials)
- 429 –æ—Ç–≤–µ—Ç—ã —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—é—Ç—Å—è `Retry-After` (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –î–ª—è production —Å –≤—ã—Å–æ–∫–∏–º —Ç—Ä–∞—Ñ–∏–∫–æ–º –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ Redis/Upstash (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å).
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã `RateLimitEntry` (–æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –∑–∞ —Å—á—ë—Ç prune).

---

### 6. **CSRF –∑–∞—â–∏—Ç–∞ –¥–ª—è state-changing API**
**–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –ù–ò–ó–ö–ò–ô (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 03.02.2026)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- `proxy.ts` (middleware) –¥–æ–±–∞–≤–ª—è–µ—Ç:
  1) –ü—Ä–æ–≤–µ—Ä–∫—É `Origin` (–∏ `Referer`, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å) –¥–ª—è –≤—Å–µ—Ö unsafe –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ `/api/*`, –∫—Ä–æ–º–µ `/api/auth/*` –∏ `/api/stripe/webhook`.
  2) Double-submit CSRF: cookie `pe_csrf` + –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-CSRF-Token` –¥–ª—è –≤—Å–µ—Ö unsafe –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ `/api/*`, –∫—Ä–æ–º–µ `/api/auth/*` –∏ `/api/stripe/webhook`.
- –†–µ–µ—Å—Ç—Ä –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤—ã–Ω–µ—Å–µ–Ω –≤ `lib/csrf.ts` (`CSRF_EXCLUDED_API_PREFIXES`) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `proxy.ts`.
- –¢–∞–±–ª–∏—Ü–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî `lib/csrf.ts`):

| Prefix | –ü—Ä–∏—á–∏–Ω–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | CSRF (double-submit) | Origin/Referer check |
|---|---|---|---|
| `/api/auth/*` | –ú–∞—Ä—à—Ä—É—Ç—ã Auth.js/NextAuth —Å–æ —Å–≤–æ–µ–π CSRF –∏ callback-–ª–æ–≥–∏–∫–æ–π | –ù–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è | –ù–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ `proxy.ts` |
| `/api/stripe/webhook` | –°–µ—Ä–≤–µ—Ä-—Å–µ—Ä–≤–µ—Ä webhook, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ `stripe-signature` | –ù–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è | –ù–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ `proxy.ts` |

- –û—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–∞–∫ JSON 403 —Å —Ç–µ–∫—Å—Ç–æ–º –Ω–∞ —Å–ª–æ–≤–∞—Ü–∫–æ–º:
  - `{ "error": "Neplatn√Ω CSRF token." }`
  - `{ "error": "Neplatn√Ω p√¥vod po≈æiadavky." }`
- –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω helper `lib/csrf.ts`, –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç cookie –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç header, –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã fetch –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –∫–æ—Ä–∑–∏–Ω—ã/—á–µ–∫–∞—É—Ç–∞ –∏ B2B dopytu (`/api/quote-request`).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ù–µ —Ä–∞—Å—à–∏—Ä—è—Ç—å ‚Äú–±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫‚Äù –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ Origin/CSRF (—Å–µ–π—á–∞—Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ `/api/auth/*` –∏ `/api/stripe/webhook`).
- –î–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö unsafe –∑–∞–ø—Ä–æ—Å–æ–≤ —Å—Ä–∞–∑—É –¥–æ–±–∞–≤–ª—è—Ç—å `X-CSRF-Token` —á–µ—Ä–µ–∑ `getCsrfHeader()`.

---

## üü° –°–†–ï–î–ù–ò–ô –†–ò–°–ö

### 7. **–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
**–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –°–†–ï–î–ù–ò–ô

**–ü—Ä–æ–±–ª–µ–º–∞:**
- SMTP credentials —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `.env`
- DATABASE_URL –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- –ù–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ secrets management

**–§–∞–π–ª—ã:**
- `.env.example`
- `.env.production.example`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/shop?schema=public"
SMTP_USER="user@example.com"
SMTP_PASS="password"
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã Docker/Kubernetes –¥–ª—è production
- –ù–µ –∫–æ–º–º–∏—Ç–∏—Ç—å `.env` —Ñ–∞–π–ª—ã (—É–∂–µ –≤ `.gitignore` ‚úÖ)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AWS Secrets Manager –∏–ª–∏ HashiCorp Vault

---

### 8. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–æ–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É (magic bytes) + –∑–∞–ø—Ä–µ—Ç SVG**
**–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –ù–ò–ó–ö–ò–ô (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 03.02.2026)

**–ß—Ç–æ –±—ã–ª–æ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –ø–æ–ª–∞–≥–∞–ª–∞—Å—å –Ω–∞ `file.type` –∏–∑ formData (–µ–≥–æ –º–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å).

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- `app/api/uploads/route.ts` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç MIME –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ (magic bytes) –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–ª—å—à–µ —Ç–æ–ª—å–∫–æ —Å ‚Äú–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º‚Äù —Ç–∏–ø–æ–º.
- –õ–æ–≥–∏–∫–∞ –¥–µ—Ç–µ–∫—Ç–∞/–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: `lib/uploads/config.ts` (`detectMimeTypeFromBuffer`, `normalizeMimeType`).
- –Ø–≤–Ω–æ –∑–∞–ø—Ä–µ—â—ë–Ω SVG, —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π/–≤–∏–¥–µ–æ (JPEG/PNG/WebP/GIF, MP4/WebM).

---

### 9. **SQL Injection –∑–∞—â–∏—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Prisma**
**–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –°–†–ï–î–ù–ò–ô (–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞—â–∏—â–µ–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ü—Ä—è–º—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ Prisma Client
- Prisma –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫:**
- –í `app/admin/products/[id]/actions.ts` –µ—Å—Ç—å PHP serialization/unserialization
- –ù–µ—Ç raw SQL, –Ω–æ –µ—Å—Ç—å —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Prisma –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å `prisma.$executeRaw` –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ raw SQL –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é

---

### 10. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
**–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –°–†–ï–î–ù–ò–ô

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö –≤ –∞–¥–º–∏–Ω–∫–µ
- –¢–æ–ª—å–∫–æ `console.error()` –¥–ª—è –æ—à–∏–±–æ–∫

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å structured logging
import winston from 'winston'

logger.info({
  event: 'admin_product_update',
  userId: session.userId,
  productId,
  changes: diff,
  timestamp: new Date()
})
```

---

## üü¢ –ù–ò–ó–ö–ò–ô –†–ò–°–ö / –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 11. **–û—Ç–∫—Ä—ã—Ç—ã–µ API endpoints –±–µ–∑ throttling**
**–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –ù–ò–ó–ö–ò–ô (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 03.02.2026)

**–ß—Ç–æ –±—ã–ª–æ:**
- `POST /api/price` –∏ –¥—Ä—É–≥–∏–µ –ø—É–±–ª–∏—á–Ω—ã–µ POST-—Ä–æ—É—Ç—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–∑—ã–≤–∞—Ç—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω DB-backed rate limiting (—Å–º. –ø—É–Ω–∫—Ç 5) –¥–ª—è:
  - `POST /api/price`
  - `POST /api/contact`
  - `POST /api/checkout`
  - `POST /api/quote-request` (5 –∑–∞–ø—Ä–æ—Å–æ–≤ / 15 –º–∏–Ω—É—Ç –Ω–∞ IP, `429` + `Retry-After`)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ï—Å–ª–∏ `/api/price` —Å—Ç–∞–Ω–µ—Ç –¥–æ—Ä–æ–≥–∏–º –ø–æ CPU/DB ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞).

---

### 12. **Security headers (CSP –∏ –±–∞–∑–æ–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏)**
**–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –ù–ò–ó–ö–ò–ô (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 03.02.2026)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –í `next.config.ts` –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏:
  - `Content-Security-Policy` (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, –Ω–æ —É–∂–µ —Ä–µ–∂–µ—Ç –æ–ø–∞—Å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: `object-src 'none'`, `frame-ancestors 'none'`, `base-uri 'self'`, `form-action 'self'`)
  - `X-Frame-Options: DENY`
  - `X-Content-Type-Options: nosniff`
  - `Referrer-Policy: strict-origin-when-cross-origin`
  - `Permissions-Policy: ...`
  - `Strict-Transport-Security` –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ production

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤/–≤–∏–¥–∂–µ—Ç–æ–≤ ‚Äî –æ–±–Ω–æ–≤–ª—è—Ç—å CSP –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ (–ª—É—á—à–µ —Ç–æ—á–µ—á–Ω–æ, —á–µ–º ‚Äú—Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å—ë‚Äù).

---

### 13. **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞**
**–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –ù–ò–ó–ö–ò–ô (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 03.02.2026)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- `lib/uploads/config.ts`: `sanitizeFileName()` —Ä–µ–∂–µ—Ç –ø—É—Ç—å, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∏–º—è –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É (255 —Å–∏–º–≤–æ–ª–æ–≤).
- `app/api/assets/[assetId]/download/route.ts`: –∏–º—è —Ñ–∞–π–ª–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —á–∏—Å—Ç–∏—Ç—Å—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ `Content-Disposition`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é –∫ user-provided filenames –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –≤ S3 key –∏ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –æ—Ç–≤–µ—Ç–∞.

---

## ‚úÖ –•–û–†–û–®–ò–ï –ü–†–ê–ö–¢–ò–ö–ò (–Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ)

1. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ scrypt** ‚úÖ
   - `lib/auth.ts` (—Å—Ç—Ä–æ–∫–∏ 30-36)
   - –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–æ–ª—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–æ–ª—è

2. **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ cookies –¥–ª—è —Å–µ—Å—Å–∏–π (NextAuth)** ‚úÖ
   - HttpOnly cookie, `secure` –≤ production, `sameSite: "lax"`

3. **CSRF + Origin/Referer –∑–∞—â–∏—Ç–∞ –¥–ª—è state-changing API** ‚úÖ
   - `proxy.ts`: cookie `pe_csrf` + `X-CSRF-Token` –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ cross-origin unsafe –∑–∞–ø—Ä–æ—Å–æ–≤

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Zod** ‚úÖ
   - –í—Å–µ API endpoints –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

5. **Honeypot –≤ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π —Ñ–æ—Ä–º–µ** ‚úÖ
   - `app/api/contact/route.ts` (—Å—Ç—Ä–æ–∫–∏ 59-64)
   - –ü–æ–ª–µ `company` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±–æ—Ç–æ–≤

6. **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è HTML** ‚úÖ
   - `lib/sanitize-html.ts`
   - Whitelist —Ç–µ–≥–æ–≤ –∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤

7. **TypeScript strict mode** ‚úÖ
   - `tsconfig.json` (—Å—Ç—Ä–æ–∫–∞ 6)
   - –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è

8. **Prisma –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç SQL Injection** ‚úÖ
   - –ù–µ—Ç raw SQL –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–í–ï–†–ö–ò

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏:** 0
- **–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫:** 0
- **–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫:** 4
- **–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫:** 0
- **–•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:** 8

---

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ô –ü–õ–ê–ù –£–°–¢–†–ê–ù–ï–ù–ò–Ø

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 –¥–Ω–µ–π):
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –≤—Å–µ—Ö `/admin/*` –º–∞—Ä—à—Ä—É—Ç–∞—Ö
2. ‚úÖ –ó–∞—â–∏—Ç–∏—Ç—å `/api/uploads` –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–µ—Å—Å–∏–∏
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –≤–æ –≤—Å–µ server actions

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ (1-2 –Ω–µ–¥–µ–ª–∏):
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π (User, Admin)
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å CSRF –∑–∞—â–∏—Ç—É
6. ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å in-memory rate limiting –Ω–∞ PostgreSQL
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ñ–∞–π–ª–æ–≤ –ø–æ magic bytes (–∏ –∑–∞–ø—Ä–µ—Ç SVG)
8. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å structured logging

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ (1 –º–µ—Å—è—Ü):
9. ‚úÖ –í–Ω–µ–¥—Ä–∏—Ç—å CSP + security headers
10. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å secrets management –¥–ª—è production
11. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
12. –ü—Ä–æ–≤–µ—Å—Ç–∏ penetration testing

---

## üìã –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### Docker –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- ‚úÖ Multi-stage build –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ Non-root user –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `Dockerfile`
- ‚ö†Ô∏è –í `docker-compose.yml` –ø–∞—Ä–æ–ª–∏ –ë–î –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- Next.js 16.1.2 ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è ‚úÖ
- React 19.2.3 ‚Äî –Ω–æ–≤–µ–π—à–∞—è –≤–µ—Ä—Å–∏—è ‚úÖ
- Prisma 7.3.0 ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è ‚úÖ
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å `npm audit`

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- –•–æ—Ä–æ—à–µ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ server/client components ‚úÖ
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `"use cache"` –∏ `cacheTag` ‚úÖ
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `"use server"` –¥–ª—è actions ‚úÖ

---

## üîí –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

**–ò—Å—Ö–æ–¥–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (–¥–æ –º–∏–≥—Ä–∞—Ü–∏–∏):** üî¥ **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô**

**–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å (–ø–æ—Å–ª–µ —É—Å–∏–ª–µ–Ω–∏–π 03.02.2026):** üü¢ **–ü–†–ò–ï–ú–õ–ï–ú–´–ô (–ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö production secrets –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)**

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ/—É—Å–∏–ª–µ–Ω–æ:**
- ‚úÖ –ê–¥–º–∏–Ω–∫–∞ –∑–∞—â–∏—â–µ–Ω–∞ middleware + requireAdmin()
- ‚úÖ Upload API —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- ‚úÖ Server actions –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–∏
- ‚úÖ –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (USER, ADMIN)
- ‚úÖ JWT —Å–µ—Å—Å–∏–∏ —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ cookies
- ‚úÖ CSRF + Origin/Referer –∑–∞—â–∏—Ç–∞ –¥–ª—è state-changing API
- ‚úÖ DB-backed rate limiting –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –∏ auth
- ‚úÖ Upload hardening: magic bytes + –∑–∞–ø—Ä–µ—Ç SVG + —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º—ë–Ω —Ñ–∞–π–ª–æ–≤
- ‚úÖ Security headers: CSP, XFO, nosniff, HSTS (prod) –∏ –¥—Ä.
- ‚úÖ Cookie consent –±–∞–Ω–Ω–µ—Ä (GDPR) ‚Äî `components/cookie-consent.tsx`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (`lib/env.ts` + `instrumentation.ts`)

**–û—Å—Ç–∞—ë—Ç—Å—è –ø–µ—Ä–µ–¥ production:**
- ‚úÖ Secrets management: `NEXTAUTH_SECRET`, SMTP, `DATABASE_URL` –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ Zod (`lib/env.ts`); –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∫–∞–∫ —Å–µ–∫—Ä–µ—Ç—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- ‚úÖ Structured logging / monitoring —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ –∫–æ–¥–µ –∏ docker-compose.prod: pino JSON logs, requestId, —Å–æ–±—ã—Ç–∏—è `5xx/auth/csrf/origin/rate_limit`, Loki/Promtail/Grafana + email alert rules.
- ‚úÖ Error boundaries –∏ loading states –¥–ª—è site –∏ admin route groups.
- ‚ö†Ô∏è –†—É—á–Ω–æ–π security smoke test (–∏ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ pen test) –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º.
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Redis/Upstash –¥–ª—è rate limiting –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º —Ç—Ä–∞—Ñ–∏–∫–µ.

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

- –ê—É–¥–∏—Ç –ø—Ä–æ–≤–µ–¥—ë–Ω: 25 —è–Ω–≤–∞—Ä—è 2026
- –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞: 21 —Ñ–µ–≤—Ä–∞–ª—è 2026 (–¥–æ–±–∞–≤–ª–µ–Ω—ã: cookie consent, env validation, error boundaries)
- –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ NextAuth v5 –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 25 —è–Ω–≤–∞—Ä—è 2026
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ä—É—á–Ω–æ–π penetration testing –ø–µ—Ä–µ–¥ production deployment
- –°–ª–µ–¥—É–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm audit`)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ production –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á—ë–Ω –ø—Ä–∏ –¥–µ–ø–ª–æ–µ (Grafana/Loki stack)

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô –î–õ–Ø PRODUCTION

### –î–æ –∑–∞–ø—É—Å–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
1. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ NextAuth v5 ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
2. ‚úÖ –ó–∞—â–∏—Ç–∞ –∞–¥–º–∏–Ω–∫–∏ ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
3. ‚úÖ –ó–∞—â–∏—Ç–∞ upload API ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
4. ‚úÖ –ó–∞—â–∏—Ç–∞ server actions ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
5. ‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ Prisma Studio
6. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SMTP –¥–ª—è production
7. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `NEXTAUTH_SECRET` —á–µ—Ä–µ–∑ `openssl rand -base64 32`
8. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `NEXTAUTH_URL` –¥–ª—è production –¥–æ–º–µ–Ω–∞

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
9. Redis/Upstash –¥–ª—è rate limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –±—É–¥–µ—Ç –≤—ã—Å–æ–∫–∏–π —Ç—Ä–∞—Ñ–∏–∫)
10. ‚úÖ CSRF protection –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö endpoints
11. Secrets manager (AWS/Vault) –≤–º–µ—Å—Ç–æ .env
12. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ magic bytes –¥–ª—è —Ñ–∞–π–ª–æ–≤ (+ –∑–∞–ø—Ä–µ—Ç SVG)
13. WAF (Web Application Firewall) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
14. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ + structured logging (Sentry, DataDog –∏ —Ç.–ø.)

### –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
15. –†–µ–≥—É–ª—è—Ä–Ω—ã–π `npm audit` + –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
16. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
17. Quarterly penetration testing
18. Security headers audit (CSP, HSTS, etc.)

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞**
