// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())
}

enum PriceType {
  ON_REQUEST
  FIXED
  MATRIX
  AREA
}

enum PricingKind {
  BASE
  FINISHING
}

model Category {
  id          String     @id @default(uuid()) @db.Uuid
  slug        String     @unique
  name        String
  image       String
  description String?
  sortOrder   Int        @default(0)
  isActive    Boolean    @default(true)
  parentId    String?    @db.Uuid
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")
  products    Product[]
}

model Product {
  id          String         @id @default(uuid()) @db.Uuid
  slug        String         @unique
  name        String
  categoryId  String         @db.Uuid
  category    Category       @relation(fields: [categoryId], references: [id])
  wpProductId Int?
  excerpt     String?
  description String?
  priceType   PriceType      @default(ON_REQUEST)
  priceFrom   Decimal?       @db.Decimal(12, 2)
  vatRate     Decimal        @default(0.20) @db.Decimal(4, 2)
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  images      ProductImage[]
  pricingModels PricingModel[]

  @@index([categoryId])
}

model ProductImage {
  id        String  @id @default(uuid()) @db.Uuid
  productId String  @db.Uuid
  product   Product @relation(fields: [productId], references: [id])
  url       String
  alt       String?
  sortOrder Int     @default(0)
  isPrimary Boolean @default(false)

  @@index([productId])
  @@unique([productId, url])
}

model PricingModel {
  id            String        @id @default(uuid()) @db.Uuid
  productId     String        @db.Uuid
  product       Product       @relation(fields: [productId], references: [id])
  kind          PricingKind
  sourceMtypeId Int
  breakpoints   Json
  numStyle      Int?
  numType       Int?
  meta          Json?
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  entries       PricingEntry[]

  @@index([productId])
  @@unique([productId, sourceMtypeId])
}

model PricingEntry {
  id             String       @id @default(uuid()) @db.Uuid
  pricingModelId String       @db.Uuid
  pricingModel   PricingModel @relation(fields: [pricingModelId], references: [id], onDelete: Cascade)
  attrsKey       String
  breakpoint     Int
  price          Decimal      @db.Decimal(12, 2)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@unique([pricingModelId, attrsKey, breakpoint])
  @@index([pricingModelId, attrsKey])
  @@index([pricingModelId, breakpoint])
}

model WpMatrixType {
  mtypeId         Int     @id
  productId       Int
  mtype           Int
  isActive        Boolean @default(true)
  title           String?
  defQuantity     Int?
  attributes      String?
  aterms          String?
  numbers         String?
  numStyle        Int?
  numType         Int?
  bqNumbers       String?
  ltextAttr       Int?
  bookMinQuantity Int?
  pqStyle         Int?
  pqNumbers       String?
  sorder          Int?
  minQMailed      Int?
}

model WpMatrixPrice {
  id       Int     @id @default(autoincrement())
  mtypeId  Int
  aterms   String
  number   BigInt
  price    Decimal @db.Decimal(18, 2)

  @@unique([mtypeId, aterms, number])
  @@index([mtypeId])
}

model WpTerm {
  termId    Int     @id
  name      String
  slug      String?
  termGroup Int?
}

model WpTermTaxonomy {
  termTaxonomyId Int     @id
  termId         Int
  taxonomy       String
  description    String?
  parent         Int?
  count          Int?

  @@index([termId])
  @@index([taxonomy])
}

model WpTermRelationship {
  id              Int @id @default(autoincrement())
  objectId        Int
  termTaxonomyId  Int
  termOrder       Int?

  @@unique([objectId, termTaxonomyId])
  @@index([objectId])
  @@index([termTaxonomyId])
}

model WpTermMeta {
  metaId    Int    @id
  termId    Int
  metaKey   String?
  metaValue String?

  @@index([termId])
  @@index([metaKey])
}

model WpAttributeTaxonomy {
  attributeId     Int     @id
  attributeName   String
  attributeLabel  String
  attributeType   String?
  attributeOrder  Int?
  attributePublic Int?
}
